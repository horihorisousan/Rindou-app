# デプロイ前チェックリスト

このチェックリストを使って、デプロイ前にすべての項目が完了していることを確認してください。

## ✅ コードの確認

### 1. ビルドが成功する
```bash
npm run build
```
- [ ] エラーなくビルドが完了する

### 2. 環境変数の確認
```bash
cat .env.local
```
- [ ] `NEXT_PUBLIC_SUPABASE_URL` が設定されている
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY` が設定されている

### 3. 本番環境でも動作するコード
- [ ] `console.log`を削除または最小限に（デバッグ用のものは残してOK）
- [ ] ハードコーディングされた値がない（すべて環境変数から取得）
- [ ] エラーハンドリングが適切

## ✅ Supabaseの確認

### 1. データベーステーブル
- [ ] `profiles` テーブルが存在する
- [ ] `roads` テーブルが存在する
- [ ] `comments` テーブルが存在する
- [ ] `likes` テーブルが存在する

### 2. RLS（Row Level Security）ポリシー
```sql
-- 確認コマンド（Supabase SQL Editorで実行）
SELECT tablename, rowsecurity FROM pg_tables WHERE schemaname = 'public';
```
- [ ] すべてのテーブルでRLSが有効（rowsecurity = true）

### 3. 認証設定
Supabase Settings → Authentication で確認:
- [ ] Email認証が有効
- [ ] Confirm email が設定されている（本番では有効推奨）

## ✅ Gitリポジトリの確認

### 1. .gitignoreの確認
```bash
cat .gitignore
```
以下が含まれていること:
- [ ] `.env.local`
- [ ] `.env*.local`
- [ ] `node_modules/`
- [ ] `.next/`

### 2. センシティブ情報の確認
```bash
# .env.localがコミットされていないことを確認
git status
git log --all --full-history -- .env.local
```
- [ ] `.env.local`がGitにコミットされていない
- [ ] APIキーやシークレットがコードに含まれていない

### 3. Gitの状態
```bash
git status
```
- [ ] コミットされていない変更がない（またはあってもデプロイに不要）

## ✅ セキュリティの確認

### 1. 環境変数の管理
- [ ] `.env.local`はローカル専用
- [ ] 本番環境の環境変数はVercelで設定する
- [ ] `.env.local.example`ファイルがある（キーの例を記載、値は空）

### 2. Supabase RLSポリシー
- [ ] 認証されていないユーザーは読み取りのみ
- [ ] ユーザーは自分のデータのみ編集可能
- [ ] データの削除権限が適切に設定されている

### 3. XSS・SQLインジェクション対策
- [ ] ユーザー入力を適切にサニタイズ
- [ ] Supabaseクエリでパラメータバインディングを使用
- [ ] DOMに直接HTMLを挿入していない（`dangerouslySetInnerHTML`の使用を避ける）

## ✅ パフォーマンスの確認

### 1. 画像の最適化
- [ ] 必要に応じてNext.js Imageコンポーネントを使用
- [ ] 画像サイズが適切（大きすぎない）

### 2. データ取得の最適化
- [ ] 不要なデータを取得していない
- [ ] ページネーションやインフィニットスクロールを検討（大量データの場合）
- [ ] データベースのインデックスが適切

### 3. キャッシングの設定
- [ ] 静的ページは適切にキャッシュされる
- [ ] APIレスポンスのキャッシュ戦略が適切

## ✅ UXの確認

### 1. エラーメッセージ
- [ ] ユーザーにわかりやすいエラーメッセージ
- [ ] ローディング状態の表示
- [ ] 操作のフィードバック（成功・失敗）

### 2. レスポンシブデザイン
- [ ] スマホで表示を確認
- [ ] タブレットで表示を確認
- [ ] PCで表示を確認

### 3. アクセシビリティ
- [ ] キーボード操作が可能
- [ ] 適切なHTMLセマンティクス
- [ ] altテキストが設定されている（画像がある場合）

## ✅ テストの実行

### 1. ローカルでの動作確認
```bash
npm run dev
```
以下を確認:
- [ ] ログインできる
- [ ] 新規登録できる
- [ ] 林道を投稿できる
- [ ] 林道が地図に表示される
- [ ] コメントできる
- [ ] いいねできる
- [ ] プロフィールページが表示される
- [ ] ログアウトできる

### 2. 本番ビルドでの動作確認
```bash
npm run build
npm start
```
- [ ] 本番ビルドでも動作する
- [ ] エラーがログに出ていない

## ✅ ドキュメントの確認

### 1. README.md
- [ ] プロジェクトの説明がある
- [ ] セットアップ手順が記載されている
- [ ] 環境変数の説明がある

### 2. その他のドキュメント
- [ ] `DEPLOYMENT_GUIDE.md` がある
- [ ] `LIKES_FEATURE_SETUP.md` がある（いいね機能のセットアップ）
- [ ] 必要に応じてAPI仕様書がある

## ✅ バックアップ

### 1. データベースのバックアップ
Supabase Settings → Database → Backups で確認:
- [ ] 自動バックアップが有効
- [ ] バックアップの頻度が適切

### 2. コードのバックアップ
- [ ] GitHubにプッシュ済み
- [ ] 重要なブランチが保護されている（mainブランチなど）

## ✅ デプロイ準備完了

すべての項目をチェックしたら、デプロイ準備完了です！

次のステップ:
1. `DEPLOYMENT_GUIDE.md` を参照してVercelにデプロイ
2. 環境変数を設定
3. 本番環境で動作確認
4. Supabaseの設定を更新（Site URLとRedirect URLs）

---

## 📝 メモ欄

デプロイ中に気づいたことや問題があればここにメモ:

```
（ここにメモを記入）
```

---

## 🎉 デプロイ完了後

- [ ] 本番環境でログインを確認
- [ ] 本番環境で全機能を確認
- [ ] エラーログをチェック（Vercelダッシュボード）
- [ ] パフォーマンスをチェック（Vercel Speed Insights）
- [ ] URLを関係者に共有

おめでとうございます！デプロイ成功です🎉
