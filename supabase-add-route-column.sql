-- ================================================================
-- roadsテーブルにルート情報（複数座標）を追加
-- ================================================================
-- このSQLをSupabaseのSQL Editorで実行してください
--
-- 実行手順:
-- 1. Supabaseダッシュボード (https://app.supabase.com/) にアクセス
-- 2. プロジェクトを選択
-- 3. 左サイドバーの「SQL Editor」をクリック
-- 4. このスクリプト全体をコピー&ペースト
-- 5. 「Run」ボタンをクリックして実行
-- ================================================================

-- routeカラムを追加（JSONB型で座標配列を保存）
-- 例: [{"lat": 35.6762, "lng": 139.6503}, {"lat": 35.6863, "lng": 139.6983}]
ALTER TABLE public.roads
ADD COLUMN IF NOT EXISTS route JSONB;

-- routeカラムにインデックスを作成（検索を高速化）
CREATE INDEX IF NOT EXISTS roads_route_idx ON public.roads USING gin(route);

-- 変更を即座にAPIに反映
NOTIFY pgrst, 'reload schema';

-- ================================================================
-- 使用例：
-- ================================================================
-- 単一座標の場合（従来通り、latitudeとlongitudeを使用）:
-- latitude: 35.6762, longitude: 139.6503, route: null
--
-- 複数座標のルートの場合:
-- latitude: 35.6762 (始点の緯度)
-- longitude: 139.6503 (始点の経度)
-- route: [
--   {"lat": 35.6762, "lng": 139.6503},
--   {"lat": 35.6863, "lng": 139.6983},
--   {"lat": 35.6964, "lng": 139.7183}
-- ]
--
-- 注意:
-- - latitude/longitudeは始点の座標として保持し、地図上の位置表示に使用
-- - routeが存在する場合は、地図上に線（ポリライン）として表示
-- - routeがnullの場合は、latitude/longitudeを使って単一マーカーとして表示
-- ================================================================
